:imagesdir: ../../assets/images
include::../style.adoc[]


== Adding Schema to the Schema Registry


In this section, you will add a new schema to the Schema Registry and later the producer and consumers will use the schema to send and receive messages.

* First let's create a topic that we can use for this section. Run the following command in the *upper terminal*.
+
[source,sh,role="execute",subs=attributes+]
----
oc run -n kafka-{user_name} topic-create --rm -it --restart=Never \
  --image=registry.redhat.io/amq-streams/kafka-40-rhel9:3.0.0 -- \
  bash -lc '/opt/kafka/bin/kafka-topics.sh --bootstrap-server kafka-kafka-bootstrap:9092 --create --topic schema-demo --partitions 3 --replication-factor 1'
----

* Navigate to the {registry} UI by clicking the link: https://service-registry-ui-{user_name}.{openshift_cluster_subdomain}[Schema Registry, window="_schema-registry"].

* You should see the explore page of the Schema Registry UI as shown in the image below.
+
image::m5/schema-registry-ui-explore.png[]

* Click on the `Create Group` button.
+
image::m5/create-group-registry.png[]

* Enter the group name `my-group` and hit the create button.
+
image::m5/create-mygroup.png[]

* Click on the `Create Artifact` button to create a new schema.
+
image::m5/create-artifact.png[]


* Enter the same name as the topic name `schema-demo` in the Artifact Id and select Avro as the schema type. Click on Next.
+
image::m5/artifact-coordinates.png[]

[NOTE]
====
The Artifact Id and topic name need not always be the same. In our case we are using the SimpleTopicIdStrategy so we used the same name. There are different strategies that you can use. You can learn more about them link:https://docs.redhat.com/en/documentation/red_hat_build_of_apicurio_registry/3.1/html/apicurio_registry_user_guide/using-kafka-client-serdes_registry#registry-serdes-concepts-strategy_registry[here].
====

* All the fields in the next screen are optional. Leave them blank and click on Next.
+
image::m5/artifact-metadata.png[]

* On the next screen, under the contents section, copy and paste the below schema. Leave the Version number field blank. This is a simple Avro schema for a customer record.
+
[source,avro,role="execute",subs=attributes+]
----
{
  "type": "record",
  "name": "Customer",
  "namespace": "com.example.avro",
  "doc": "A sample Avro schema for a customer record",
  "fields": [
    {"name": "customer_id", "type": "string", "doc": "Unique identifier for the customer"},
    {"name": "first_name", "type": "string", "doc": "Customer's first name"},
    {"name": "last_name", "type": "string", "doc": "Customer's last name"},
    {"name": "email", "type": ["null", "string"], "default": null, "doc": "Email address (optional)"},
    {"name": "age", "type": ["null", "int"], "default": null, "doc": "Customer age (optional)"},
    {"name": "is_active", "type": "boolean", "default": true, "doc": "Whether the customer is active"},
    {"name": "signup_date", "type": {"type": "long", "logicalType": "timestamp-millis"}, "doc": "Timestamp of when the customer signed up"}
  ]
}
----

* Click on Next.
+
image::m5/create-schema.png[]

* This is a simple schema which defines the rules for the fields of the message containing the customer data. You can learn more about Avro schemas link:https://avro.apache.org/[here].

* Click on Create on the final screen while leaving the fields blank.
+
image::m5/create-schema-final.png[]

* The artifact should take a couple of seconds to be created and then you should see the schema in the *Schema Registry UI* as shown in the image below.
+
image::m5/schema-created.png[]

* Great job! You have successfully added a new schema to the Schema Registry. 

=== Up Next
In the next section, we will see how to producer and consumer application use this schema to send and receive messages and make sure that the messages conform to the schema.
