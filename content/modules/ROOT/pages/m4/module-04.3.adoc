:imagesdir: ../../assets/images
include::../style.adoc[]


== Globex Loyalty Program with Change Data Capture

* To understand a sample application that uses Change Data Capture, we will create a loyalty program that tracks customer purchases and awards loyalty points. The loyalty program application will consume change events from the Debezium topics and update loyalty points accordingly.

* Navigate to the tab with the *Devspaces* IDE

* Select the *loyalty-deployment.yaml* file in the *kafka-workshop/module-cdc* folder

* Replace the placeholder value for the bootstrap servers(line 28) with the following value
+
[source,bash,role=execute,subs="attributes"]
----
kafka-kafka-bootstrap.kafka-{user_name}.svc.cluster.local:9092
----



* Deploy the loyalty program application to your OpenShift project by running the following command in your devspaces terminal
+
[source,bash,role=execute,subs="attributes"]
----
oc apply -f module-cdc/loyalty-deployment.yaml -n globex-{user_name}
----

* This deploys a simple Quarkus application that consumes change events from the Debezium topics and updates loyalty points accordingly. Check the deployment status and make sure the application is running.
+
[source,bash,role=execute,subs="attributes"]
----
oc get pods -n globex-{user_name} -l app=cdc-dashboard -w
----

* Once the status of the pod shows *Running*, type `ctrl+c` in the devspaces terminal. 

* You can access the loyalty program dashboard by navigating to the route created for the application.

* Open the link:https://cdc-dashboard-globex-{user_name}.{openshift_cluster_subdomain}[Loyalty Program Dashboard, window="loyalty"] to access the loyalty program dashboard deployed in the globex-{user_name} 

* This dashboard builds a real-time view of customer loyalty points based on the change events captured from the Globex retail application database. It uses the messages in the *globex.updates.public.orders* and *globex.updates.public.line_item* topic to track customer purchases and update loyalty points accordingly without directly interacting with the retail application database.
+
image::m4/loyalty-dashboard.png[]

* As more orders are created in the Globex retail application, the more change events are produced to the Debezium topics, and the loyalty program dashboard updates the loyalty points in real-time.

* Feel free to generate more orders in the Globex retail application using the link:https://order-simulator-globex-{user_name}.{openshift_cluster_subdomain}[Order Simulator, window="order-simulator"] as shown in the previous section, and see how the loyalty points are updated in real-time in the dashboard.


* The loyalty program application team can now build their own services and applications that leverage the change events produced by Debezium, without having to directly interact with the Globex retail application database. This decouples the loyalty program from the retail application, enabling more flexibility and scalability in building event-driven applications.

* Another use case could be *build a real time order tracker* that could be displayed on screens in the warehouse showing incoming orders as they are created for the warehouse team to process them quickly. You can see a sample application link:https://cdc-dashboard-globex-{user_name}.{openshift_cluster_subdomain}/warehouse[here, window="warehouse"].

* Feel free to explore the source code of the loyalty program application and the order tracker application link:https://github.com/streams-kafka-workshop/module-cdc[here, window="_github"].

This brings us to the end of this module on Change Data Capture with Debezium. In this module, we have seen how to deploy a Debezium connector to capture change events from a relational database and produce them to Kafka topics in real-time. We also saw how to build simple applications that consume these change events to build event-driven applications.


