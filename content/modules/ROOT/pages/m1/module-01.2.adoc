:imagesdir: ../../assets/images
include::../style.adoc[]


== Kafka Basics - Partitions (how Kafka scales & orders)

Storing the messages in a topic in a single node would limit the scalability of the system. Partitions are the solution for this. A topic is split into partitions, each an ordered, append-only log, that are distributed across brokers. This allows kafka to process a large number of messages in parallel and in a distributed manner. Partitions enable parallelism and throughput.

image::m1/topic-image.png[]

=== Ordering rule

* Strict order exists within a partition.

* Global ordering is not guaranteed across a topic — 

* If you need ordering, use the same key to ensure all events for that key go to the same partition.

=== Offsets

Each record in a partition has a monotonically increasing offset (0, 1, 2…). Offsets are the consumer’s “cursor”.

=== Lag

The difference between the offset of the last message consumed and the offset of the last message in the partition. It basically represents the number of messages that have not been consumed yet in a partition.

=== Replication & durability

Each partition has one leader and replicas (followers).

Replication factor (e.g., 3) determines durability and availability.

Producers/consumers talk to the leader; followers keep up via replication.

image::m1/replication-broker.png[]



=== Key-based routing

With a key, the records/messages with the same key go to the same partition → per-key order.

With no key, producers distribute across partitions and order is not guaranteed.


=== Exercise

* Click https://amq-streams-console-{user_name}.{openshift_cluster_subdomain}/kafka/[here, window="console"] to navigate to the {streams} console to view the topic you created.

* Click on *Topics* in the left menu to see the list of topics. You should see the `demo` topic you created. Click on the `demo`topic and then navigate to the partitions tab. You should see the `demo` topic  has 3 partitions.
+
image::m1/partitions-image-console.png[]

* The partitions are spread across different brokers to ensure fault tolerance. The leader column shows the Broker ID in which the partition is located. 
+
image::m1/leader-image-console.png[]


* The replicas column typically shows the broker IDs of the other brokers that hold replicas of the partition and currently there are empty since we have created our topic with replication factor of 1 (which is not recommended in a production setup).
+
image::m1/replica-image-console.png[]

This concludes are very high-level overview of how Kafka partitions work. In the next module we'll learn about kafka producers and consumers.