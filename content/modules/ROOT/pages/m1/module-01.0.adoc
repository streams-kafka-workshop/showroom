:imagesdir: ../../assets/images
include::../style.adoc[]

== Module 1: 
{m1}

=== Kafka Basics - What is a Kafka Cluster?

A Kafka cluster is the whole distributed system that stores and moves your events. It’s made up of multiple Kafka processes with specific roles:

Controllers (KRaft): keep the cluster’s metadata (what topics/partitions exist, which broker leads which partition, etc.) and run leader elections.

Brokers: store data and serve client traffic .

=== Why clusters matter:

* Scalability: add more brokers → more throughput and storage.

* Fault tolerance: replicate partitions across brokers so a node loss doesn’t lose data or availability.

* Central bootstrap: clients connect to a single “bootstrap” address (e.g., my-kafka-kafka-bootstrap:9092) and discover the rest.

* In OpenShift/AMQ Streams with KRaft + Node Pools:

** The Kafka CR defines cluster-wide settings (Kafka version, listeners, configs).

** KafkaNodePool CRs create sets of controller nodes and broker nodes.

== Kafka Basics - What is a Kafka Broker?

A broker is one Kafka server process that:

* Stores topic partitions on disk (append-only logs, with retention policies).

* Handles produce (writes) and consume (reads) requests.

* Replicates partitions to/from peers; one broker is the leader for a partition, others are followers (when replication factor > 1).

// image:m1/rhsi_architecture_image.png[]

//image:m1/m1-arch.png[] 

== Activities overview:

== Activity: Set up Kafka on OpenShift
. Create your kafka namespace
+
[source,sh,role="execute",subs=attributes+]
----
oc new-project kafka || oc project kafka
----

. Create a Kafka cluster using the operator
+
[source,sh,role="execute",subs=attributes+]
----
apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-kafka
  namespace: kafka
  annotations:
    strimzi.io/kraft: "enabled"
    strimzi.io/node-pools: "enabled"
spec:
  kafka:
    version: 3.9.0
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
    config:
      # single-broker lab settings
      offsets.topic.replication.factor: 1
      transaction.state.log.replication.factor: 1
      transaction.state.log.min.isr: 1
      default.replication.factor: 1
      min.insync.replicas: 1
      auto.create.topics.enable: "true"
  entityOperator:
    topicOperator: {}
    userOperator: {}
----

. Create the controller node pool
+
[source,sh,role="execute",subs=attributes+]
----
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaNodePool
metadata:
  name: my-kafka-controllers
  namespace: kafka
  labels:
    strimzi.io/cluster: my-kafka
spec:
  replicas: 1
  roles: [controller]
  storage:
    type: ephemeral
----

. Create the broker node pool
+
[source,sh,role="execute",subs=attributes+]
----
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaNodePool
metadata:
  name: my-kafka-brokers
  namespace: kafka
  labels:
    strimzi.io/cluster: my-kafka
spec:
  replicas: 1
  roles: [broker]
  storage:
    type: ephemeral
----

. Verify that the Kafka cluster is running
+
[source,sh,role="execute",subs=attributes+]
----
oc get pods -n kafka -w
----



